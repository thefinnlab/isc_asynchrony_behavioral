---
title: "subject_accuracy_stats"
author: "Tommy Botch"
date: "2024-11-15"
output: html_document
---

# Setup environment

## Load packages

```{r}
# remove all variables
rm(list=ls()) 

# install.packages(c("lmerTest", "emmeans", "glue", "ggeffects", "ggplot2", 
#                    "ggsignif", "ggpattern", "viridis", "forcats", "dplyr",
#                    "stringr", "tools", "lmer4", "combinat", "ggpubr", "report",
#                    "rcompanion", "sjPlot", "glmmTMB", "DHARMa", "tidyverse"))

library(lmerTest)
library(emmeans)
library(glue)
library(ggeffects)
library(ggplot2)
library(sjPlot)
library(report)
library(rcompanion)
library(sjPlot)

library(DHARMa)
library(glmmTMB)
library(tidyverse)
library(performance)
library(ordinal)
```

## Prepare directories

Set up directories - since we're doing this locally (and mounting the server), 
we're going to use a different base_dir

```{r}

base_dir<-'/Volumes/FinnLab/tommy/isc_asynchrony_behavior/derivatives/'
results_dir<-glue('{base_dir}results/behavioral/')
plots_dir <- glue('{base_dir}plots/final/')

```

## Functions

```{r}
# Function to convert specified columns to factors
convert_columns_to_factors <- function(df, columns_to_convert) {
  # Check if all specified columns exist in the dataframe
  if (!all(columns_to_convert %in% names(df))) {
    missing_cols <- columns_to_convert[!columns_to_convert %in% names(df)]
    stop(paste("The following columns do not exist in the dataframe:", 
               paste(missing_cols, collapse = ", ")))
  }
  
  # Convert each specified column to factor
  for (col in columns_to_convert) {
    df[[col]] <- factor(df[[col]])
  }
  
  return(df)
}

```

# Run subject-level analysis

## Data loading

Load data and set factor columns 

```{r}

# Load the results file
results_fn<-glue('{results_dir}all-task_subject-behavior_lemmatized.csv')
df_results <- read.csv(results_fn)

# Set the variable types
factor_columns <- c('modality', 'prolific_id', 'subject', 'word_index', 'task')
df_results <- convert_columns_to_factors(df_results, factor_columns)
df_results
```

## Logistic regression

Classify accuracy based on modality. Conduct a contrast of audio > text

```{r}

# subject model for accuracy --> test if audio > text
audio_greater_text <- c(1,-1)
contrasts(df_results$modality) <- cbind(audio_greater_text)

subject_accuracy_formula <- 'accuracy ~ modality + (1|word_index:task) + (1|subject:modality:task)'

# Fit the logistic mixed-effects model
model <- glmer(subject_accuracy_formula, 
               data = df_results, 
               family = binomial(link = "logit"))

tab_model(model, show.se=TRUE, show.stat=TRUE, show.r2=TRUE)
summary (model)
```

## Prosody interaction

Rerun the logistic regression with the mean prosody included as an interaction effect. 

```{r}

# subject model for accuracy --> test if audio > text
audio_greater_text <- c(1,-1)
contrasts(df_results$modality) <- cbind(audio_greater_text)

subject_accuracy_formula <- 'accuracy ~ modality * prominence_mean + (1|word_index:task) + (1|subject:modality:task)'

# Fit the logistic mixed-effects model
model <- glmer(subject_accuracy_formula, 
               data = df_results, 
               family = binomial(link = "logit"))

tab_model(model, show.se=TRUE, show.stat=TRUE, show.r2=TRUE)
summary (model)

```