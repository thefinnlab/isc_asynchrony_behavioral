<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych-7.2.0/jspsych/dist/jspsych.js"></script>
    <link rel="stylesheet" href="jspsych-7.2.0/jspsych/dist/jspsych.css" />
     <script src="jspsych-7.2.0/jspsych/dist/plugin-preload.js"></script>
     <script src="jspsych-7.2.0/jspsych/dist/plugin-video-keyboard-response.js"></script>
     <script src="jspsych-7.2.0/jspsych/dist/plugin-html-button-response.js"></script>
     <script src="jspsych-7.2.0/jspsych/dist/plugin-initialize-microphone.js"></script>
     <script src="jspsych-7.2.0/jspsych/dist/plugin-html-audio-response.js"></script>
     <script src="jspsych-7.2.0/jspsych/dist/plugin-survey-text.js"></script>
     <script src="jspsych-7.2.0/jspsych/dist/plugin-survey-html-form.js"></script>
     <script src="jspsych-7.2.0/jspsych/dist/plugin-instructions.js"></script>
     <script src="jspsych-7.2.0/jspsych/dist/plugin-survey-multi-choice.js"></script>
     <script src="jspsych-7.2.0/jspsych/dist/plugin-survey-likert.js"></script>
     <script src="jspsych-7.2.0/jspsych/dist/plugin-html-keyboard-response.js"></script>
    <style>
    .jspsych-btn {margin-bottom: 10px;}
  </style>
</head>
<body></body>

<script>

var movies = movies
//var participant = 1
var participant_id = 3

///////////////////////// PRACTICE TRIAL SET UP ///////////////////////
//var participant = {
//  type: jsPsychHtmlKeyboardResponse,
//  stimulus: '<p style="color: orange; font-size: 48px; font-weight: bold;">PARTICIPANT</p>',
//  prompt: "Experimenter: Enter participant number to continue>",
//  on_finish: function() {
//    var participant_id = jsPsych.data.get().first().values()[0].response;
//    alert(participant_id)
  //   participant_id = data.response
  // }
//}}

var participant = {
  type: jsPsychSurveyText,
  preamble: '<p style="color: orange; font-size: 48px; font-weight: bold;">PARTICIPANT</p>',
  questions: [
    {prompt: 'Experimenter: Enter participant number to continue>',
  placeholder: participant_id,required: false}]
}

var practice_trial1= {
    type: jsPsychInstructions,
    pages: [
    '<h2>This next part is a practice trial to show you what you will have to do while watching the movies. The next page will provide more information. If you have any questions ask your experimenter.</h2>',
    'The next page will show a movie. Press a space bar at the times at which you feel like a new scene is starting; these are points in the movie when there is a major change in topic, location, time, etc. Each scene should be between 10 seconds and 3 minutes long. These instructions will stay on the screen during the film.  These instructions will stay on the screen during the film. They will change <strong> color </strong> each time you press the space bar to let you know that you have demarcated an event.'

  ],
    show_clickable_nav: true
}
var practice_mov = {
    type: jsPsychVideoKeyboardResponse,
    stimulus: ["toast_trim.mp4"],
    prompt: "<p>Press a space bar at the times at which you feel like a new scene is starting; these are points in the story when there is a major change in topic, location, time, etc. Each scene should be between 10 seconds and 3 minutes long. </p>",
    width: 1200,
    height: 1200,

    autoplay: true,
    response_feedback: true, //Clara added
    response_allowed_while_playing: true,
    response_ends_trial: false,
    trial_ends_after_video: true,
  }
var practice_trial2= {
    type: jsPsychInstructions,
    pages: [
    'Let your experimenter know if you have any questions. It is crucial that you understand how to do this part of the task. After this section, you will be asked to use the microphone to talk about what you watched and then will be asked to answer a series of straightforward questions. We will skip those in this practice trial. Let your experimenter know when you are ready to begin the real experiment.'
  ],
    show_clickable_nav: true
}





//////////////////////// Defining functions and trials
timeline = []
//defining clock function at the top so we can just refer to it each time we need it
var clock_function = function(){
          var wait_time = 15000; //60000 when want the full range // in milliseconds
          var start_time = performance.now();
          //document.querySelector('button').disabled = true;
          var interval = setInterval(function(){
          var time_left = wait_time - (performance.now() - start_time);
          var minutes = Math.floor(time_left / 1000 / 60);
          var seconds = Math.floor((time_left - minutes*1000*60)/1000);
          var seconds_str = seconds.toString().padStart(2,'0');
          document.querySelector('#clock').innerHTML = minutes + ':' + seconds_str
          if(time_left <= 0){
              document.querySelector('#clock').innerHTML = "0:00";
              //document.querySelector('button').disabled = false;
              clearInterval(interval);
    }
    },
    250)
          }

var jsPsych = initJsPsych({
    adapt_to_file_protocol: false,
    override_safe_mode: true,
    
    on_finish: function() { jsPsych.data.displayData(); 
      //var participant_id = jsPsych.data.get().first().values()[0].response;
      var date = new Date().toISOString().slice(0, 10)
      alert(date)
      jsPsych.data.get().localSave('csv','data/eventsegbehav_participant' + participant_id + '_' + date + '.csv'); }


//jsPsych.data.get().localSave('csv','data/eventsegbehav_participant' + jsPsych.timelineVariable(participant,"true") +'.csv'); }
});


///////// Instructions here: 
var movie_instructions = {
    type: jsPsychInstructions,
    pages: [
    '<h2>During this section, you will listen to a podcast episode. Please make sure that you are paying attention</h2>',
    'Press a space bar at the times at which you feel like a new scene is starting; these are points in the story when there is a major change in topic, location, time, etc. Each scene should be between 10 seconds and 3 minutes long. These instructions will stay on the screen during the film. They will change <strong> color </strong> each time you press the space bar to let you know that you have demarcated an event.'

  ],
    show_clickable_nav: true
}

var movie_instructions_repeat = {
    type: jsPsychInstructions,
    pages: [
    '<h2>During this section, you will listen to another podcast episode. You may listen to the same podcast a second time. Please make sure that you are paying attention</h2>',
    'Press a space bar at the times at which you feel like a new scene is starting; these are points in the story when there is a major change in topic, location, time, etc. Each scene should be between 10 seconds and 3 minutes long. These instructions will stay on the screen during the film. They will change <strong> color </strong> each time you press the space bar to let you know that you have demarcated an event.'

  ],
    show_clickable_nav: true
}

var free_recall_instructions = {
    type: jsPsychInstructions,
    pages: [
    'During this section, you will have <strong> three minutes to say what you remember about the video. </strong> You can talk about characters, events, your opinions, or anything else that comes to mind. Try and fill the whole three minutes once the timer appears, and remember- there are no wrong answers! <h3>You will now be asked to initiate the microphone</h3>'],
    show_clickable_nav: true
}


var experiment_starting = {
  type: jsPsychInstructions,
    pages: [
    
    'PRESS TO BEGIN THE FIRST MOVIE.'],
    show_clickable_nav: true
}


var between_trials= {
    type: jsPsychInstructions,
    on_load: function(){
          var wait_time = 30000 //when want the full range // in milliseconds
          var start_time = performance.now();
          //document.querySelector('button').disabled = true;
          var interval = setInterval(function(){
          var time_left = wait_time - (performance.now() - start_time);
          var minutes = Math.floor(time_left / 1000 / 60);
          var seconds = Math.floor((time_left - minutes*1000*60)/1000);
          var seconds_str = seconds.toString().padStart(2,'0');
          document.querySelector('#clock').innerHTML = minutes + ':' + seconds_str
          if(time_left <= 0){
              document.querySelector('#clock').innerHTML = "0:00";
              //document.querySelector('button').disabled = false;
              clearInterval(interval);
    }
    },
    250)
          }, 
    pages: [ '<p>Time left: <span id="clock">1:00</span> </p>' + '<h1> START THE NEXT PART WHEN YOU ARE READY</h1>'

    ],
    show_clickable_nav: true
}
var welcome = {
    type: jsPsychInstructions,
    pages: [
    '<h1> WELCOME</h1>'
  ],
    show_clickable_nav: true
}
var ty = {
    type: jsPsychInstructions,
    pages: [
    '<h1> THANK YOU. Please notify the experimenter to do some debriefing questions. </h1>'
  ],
    show_clickable_nav: true
}



///// Initiation trials
var pre_trial = {
    type: jsPsychHtmlButtonResponse,
    stimulus: '<div style="max-width:600px;"> </div>',
    choices: ['continue']
  }
  
var init_mic = {
    type: jsPsychInitializeMicrophone
  } 


var free_recall = {
	type: jsPsychHtmlAudioResponse, 
	on_load: function(){
          var wait_time = 180000 //when want the full range // in milliseconds
          var start_time = performance.now();
          //document.querySelector('button').disabled = true;
          var interval = setInterval(function(){
          var time_left = wait_time - (performance.now() - start_time);
          var minutes = Math.floor(time_left / 1000 / 60);
          var seconds = Math.floor((time_left - minutes*1000*60)/1000);
          var seconds_str = seconds.toString().padStart(2,'0');
          document.querySelector('#clock').innerHTML = minutes + ':' + seconds_str
          if(time_left <= 0){
              document.querySelector('#clock').innerHTML = "0:00";
              //document.querySelector('button').disabled = false;
              clearInterval(interval);
    }
    },
    250)
          }, //set to 3 minutes
	stimulus: function(){
		var clock = '<p>Time left: <span id="clock">1:00</span> </p>';
		var statement = '<p> <strong> CURRENTLY RECORDING: </strong> During this section, you will have three minutes to say what you remember about the video. You can talk about characters, events, your opinions, or anything else that comes to mind. Try and fill the whole three minutes once the timer appears, and remember- there are no wrong answers!</p>' ;
		return clock + statement
		},
	recording_duration: 180000,
	done_button_label: "IF THE TIMER IS DONE: PRESS HERE TO END RECORDING",
	
  } 


var trial_1 = {
    type: jsPsychVideoKeyboardResponse,
    stimulus: ['dark-end-of-the-mall_edited_smaller.mp4'],
    prompt: "<p>Press a space bar at the times at which you feel like a new scene is starting; these are points in the movie when there is a major change in topic, location, time, etc.  Each scene should be between 10 seconds and 3 minutes long. </p>",
    width: 1200,
    height: 1200,
    autoplay: true,
    response_feedback: true, //Clara added
    response_allowed_while_playing: true,
    response_ends_trial: false,
    trial_ends_after_video: true,
  }
var trial_2 = {
    type: jsPsychVideoKeyboardResponse,
    stimulus: ['dark-end-of-the-mall_edited_smaller.mp4'],
    prompt: "<p>Press a space bar at the times at which you feel like a new scene is starting; these are points in the movie when there is a major change in topic, location, time, etc.  Each scene should be between 10 seconds and 3 minutes long. </p>",
    width: 1200,
    height: 1200,
    autoplay: true,
    response_feedback: true, //Clara added
    response_allowed_while_playing: true,
    response_ends_trial: false,
    trial_ends_after_video: true,
  }

timeline.push(participant)
timeline.push(welcome,practice_trial1, practice_mov , practice_trial2)
timeline.push(movie_instructions, trial_1, movie_instructions_repeat, trial_2, ty)
jsPsych.run(timeline)

//     </script>
// </html>


